# 窗口

\##本章学习Qt的基本功能

## 简单的默认窗口

这是一个显示一个小窗口的简单例子。但是我们可以在这个小窗口上面做很多事情，改变大小，最大化，最小化等，这需要很多代码才能实现。这需要很多代码。但一些人已经写好了这些功能实现。因为它在很多应用中重复出现，所以没必要去重复编写它。PyQt5是一个高级工具套件，为我们封装了很多复杂功能的实现代码，我们可以更加简单的通过函数去实现调用这些功能。如果我们是在一个低级工具套件中写代码的话，下面例子的代码很有可能需要数百行来实现。

\#!/usr/bin/python3
 \# -- coding: utf-8 --
 
 """
 ZetCode PyQt5 tutorial 
 
 In this example, we create a simple
 window in PyQt5.
 
 author: Jan Bodnar
 website: zetcode.com 
 Last edited: August 2017
 """
 
 import sys
 from PyQt5.QtWidgets import QApplication, QWidget
 
 
 if __name__ == '__main__':
​     
​     app = QApplication(sys.argv)
 
​     w = QWidget()
​     w.resize(250, 150)
​     w.move(300, 300)
​     w.setWindowTitle('Simple')
​     w.show()
​     
​     sys.exit(app.exec_())

上面的代码示例会在屏幕上显示一个小窗口。

import sys
 from PyQt5.QtWidgets import QApplication, QWidget

这里我们进行了一些必要模块的导入。最基础的widget组件位于PyQt5.QtWidget模块中

app = QApplication(sys.argv)

每个PyQt5应用都必须创建一个应用（Application）对象。sys.argv是一组来自命令行的参数列表。Python脚本可以在shell中运行，这是我们用来控制脚本启动的一种方法。

w = QWidget()

QWidget组件类是PyQt5中所有用户界面类的基础类，我们为QWidget组件类提供了默认的构造器，这默认的构造器没有父类。一个没有父类的构造器被称为窗口（window）。（所以QWidget组件类自带了一个默认的窗口）

w.resize(250, 150)

resize()方法改变了widget组件的大小，这里的意思是窗口宽250px，高150px。

w.move(300, 300)

move()是修改定位组件位置的的方法，即把组件移动到屏幕上的一个位置，使用x、y坐标。这里它把控件放置到屏幕坐标的(300, 300)的位置。（注：屏幕坐标系x、y的原点是程序的左上角？）

w.setWindowTitle('Simple')

这里我们为窗口设置了标题。这个标题显示在标题栏中。（虽然这看起来是一句废话，但是后面还有各种栏，还是要注意一下，多了就蒙了）。

w.show()

show()方法在屏幕上显示出了组件。一个组件首先在内存中被创建，然后在屏幕上显示。

sys.exit(app.exec_())

最后，应用进入主循环，此时，事件处理才从这里开始执行。主循环负责接收来自窗口系统的事件并且把它们转发到widget应用上处理。如果我们调用exit()方法或者主widget组件被销毁，主循环结束。sys.exit()方法能确保一个干净的、不留垃圾的、安全的退出。系统环境将会被通知应用是怎样被结束的。

exec_()之所以有个下划线，是因为exec是Python保留关键字。所以，用exec_()来代替。

程序预览：

![1539876903927](C:\Users\Administrator\AppData\Roaming\Typora\typora-user-images\1539876912829.png)

​                                                  

 

## 应用图标

应用图标是一个常常显示在标题栏左上方角落里的小图片。在下面的例子里，我们将展示我们如何在PyQt5中显示应用图标。我们也将介绍一些新方法的使用。

在某些环境下，图标显示不出来。如果你遇到了这个问题，看我在Stackoverfolw的回答

\#!/usr/bin/python3
 \# -- coding: utf-8 --
 
 """
 ZetCode PyQt5 tutorial 
 
 This example shows an icon
 in the titlebar of the window.
 
 Author: Jan Bodnar
 Website: zetcode.com 
 Last edited: August 2017
 """
 
 import sys
 from PyQt5.QtWidgets import QApplication, QWidget
 from PyQt5.QtGui import QIcon
 
 
 class Example(QWidget):
​     
​     def __init__(self):
​         super().__init__()
​         self.initUI()
​         
​         
​     def initUI(self):
​         
​         self.setGeometry(300, 300, 300, 220)
​         self.setWindowTitle('Icon')
​         self.setWindowIcon(QIcon('web.png'))        
​              self.show()
​         
​         
 if __name__ == '__main__':
​     
​     app = QApplication(sys.argv)
​     ex = Example()
​     sys.exit(app.exec_())

上述的例子使用传统的面向过程的代码风格。Python编程语言提供面向过程和面向对象的代码风格。PyQt5编程意味着就是面向对象的编程。

class Example(QWidget):
​     
​     def __init__(self):
​         super().__init__()
​         ...

面向对象编程中最重要的三个部分是类(class)、数据和方法。这里我们创建了一个新类叫做Example，Example类继承自QWidget类。这意味着我们调用了两个构造方法：第一个是Example类的构造方法，第二个是被继承类的构造方法。super()方法返回了Example类的父类对象，并且我们调用了父类的构造方法。__init__()方法是Python语言中的构造方法。

self.initUI() 

GUI的创建由initUI()方法来完成。

\# 自己准备一个web.png
 self.setGeometry(300, 300, 300, 220)
 self.setWindowTitle('Icon')
 self.setWindowIcon(QIcon('web.png'))  

上面的三个方法都继承自QWidget类。setGeometry()做了两件事：将窗口在屏幕上显示，并且设置了它的大小。前两个参数是窗口的x、y坐标位置，后两个参数是窗口的宽和高。事实上，这是将resize()和move()方法融合在一个方法内。最后一个方法设置了应用图标。为了做好它，我们创建了一个QIcon图标对象。QIcon图标对象接收一个我们要显示的图片的路径作为参数。

if __name__ == '__main__':
​     
​     app = QApplication(sys.argv)
​     ex = Example()
​     sys.exit(app.exec_())

应用和示例的对象（Example）被创建，主循环开始。

程序预览：

![1539876976973](C:\Users\Administrator\AppData\Roaming\Typora\typora-user-images\1539876976973.png)

   

 

## 按钮

QPushButton(string text, QWidget parent = None)

text参数是想要显示的按钮名称，即显示在按钮上的内容，parent参数是一个放置按钮的组件。应用中的组件都是分层结构的（即一层叠在一层上的），在这个分层中，大多数组件都是有它们的父类的。没有父类的组件是顶级窗口。

 

## 提示框

\#!/usr/bin/python3
 \# -- coding: utf-8 --
 
 """
 ZetCode PyQt5 tutorial 
 
 This example shows a tooltip on 
 a window and a button.
 
 Author: Jan Bodnar
 Website: zetcode.com 
 Last edited: August 2017
 """
 
 import sys
 from PyQt5.QtWidgets import (QWidget, QToolTip, 
​     QPushButton, QApplication)
 from PyQt5.QtGui import QFont    
 
 
 class Example(QWidget):
​     
​     def __init__(self):
​         super().__init__()
​         
​         self.initUI()
​         
​         
​     def initUI(self):
​         
​         QToolTip.setFont(QFont('SansSerif', 10))
​         
​         self.setToolTip('This is a <b>QWidget</b> widget')
​         
​         btn = QPushButton('Button', self)
​         btn.setToolTip('This is a <b>QPushButton</b> widget')
​         btn.resize(btn.sizeHint())
​         btn.move(50, 50)       
​         
​         self.setGeometry(300, 300, 300, 200)
​         self.setWindowTitle('Tooltips')    
​         self.show()
​         
​         
 if __name__ == '__main__':
​     
​     app = QApplication(sys.argv)
​     ex = Example()
​     sys.exit(app.exec_())

在这个例子中，我们为两个PyQt5组件显示了一个提示框。

QToolTip.setFont(QFont('SansSerif', 10))

这个静态方法设置了提示框的字体格式，我们使用了10px的SansSerif字体。

self.setToolTip('This is a <b>QWidget</b> widget')

为了创建一个提示框，我们调用了setTooltip()方法。我们可以在提示框中使用富文本格式。

btn = QPushButton('Button', self)
 btn.setToolTip('This is a <b>QPushButton</b> widget')

我们创建了一个按钮组件并且为它设置了一个提示框。

btn.resize(btn.sizeHint())
 btn.move(50, 50)

按钮被改变了大小，并且在窗口上移动了位置。setHint()方法给了按钮一个推荐的大小。

程序预览：

   ![1539877005351](C:\Users\Administrator\AppData\Roaming\Typora\typora-user-images\1539877005351.png)

 

## 关闭窗口

关闭一个窗口最显而易见的方法是点击标题栏的X叉标记。在下面的例子中，我们将展示的是怎样通过程序来关闭一个窗口。我们将简单的接触到信号和槽机制。

本例使用的是QPushButton组件类。

\#!/usr/bin/python3
 \# -- coding: utf-8 --
 
 """
 ZetCode PyQt5 tutorial 
 
 This program creates a quit
 button. When we press the button,
 the application terminates. 
 
 Author: Jan Bodnar
 Website: zetcode.com 
 Last edited: August 2017
 """
 
 import sys
 from PyQt5.QtWidgets import QWidget, QPushButton, QApplication
 from PyQt5.QtCore import QCoreApplication
 
 
 class Example(QWidget):
​     
​     def __init__(self):
​         super().__init__()
​         
​         self.initUI()
​         
​         
​     def initUI(self):               
​         
​         qbtn = QPushButton('Quit', self)
​         qbtn.clicked.connect(QCoreApplication.instance().quit)
​         qbtn.resize(qbtn.sizeHint())
​         qbtn.move(50, 50)       
​         
​         self.setGeometry(300, 300, 250, 150)
​         self.setWindowTitle('Quit button')    
​         self.show()
​         
​         
 if __name__ == '__main__':
​     
​     app = QApplication(sys.argv)
​     ex = Example()
​     sys.exit(app.exec_())

在这个例子中，我们创建一个退出按钮，一旦按下按钮，应用将会结束。

from PyQt5.QtCore import QCoreApplication

我们需要一个来自QtCore模块的对象。

qbtn = QPushButton('Quit', self)

我们创建了一个按钮。按钮是一个QPushButton类的实例。构造方法的第一个参数是显示在按钮上的标签文本。第二个参数是按钮的父级组件。父级组件是Example组件，它继承自QWiget类

qbtn.clicked.connect(QCoreApplication.instance().quit)

在PyQt5中，事件处理系统由信号&槽机制建立。如果我们点击了按钮，信号clicked被发送。槽可以是Qt内置的槽或Python 的一个方法调用。QCoreApplication类包含了主事件循环，它处理和转发所有事件。instance()方法给我们返回了一个它的当前的实例对象。注意QCoreApplication类由QApplication创建。clicked信号被连接到结束应用的quit()方法。事件通信在两个对象之间进行：发送者和接受者。这里，发送者是按钮，接受者是应用对象。

程序预览：

   

 

## 消息盒子

默认情况下，如果我们点击标题栏上的×按钮，QWidget就会被关闭。但是有时候，我们希望修改这个默认行为。比如，如果我们有个文件在编辑器内打开，并且我们对这个文件做了一些修改。 我们显示一个message box来确认这个动作。

\#!/usr/bin/python3
 \# -- coding: utf-8 --
 
 """
 ZetCode PyQt5 tutorial 
 
 This program shows a confirmation 
 message box when we click on the close
 button of the application window. 
 
 Author: Jan Bodnar
 Website: zetcode.com 
 Last edited: August 2017
 """
 
 import sys
 from PyQt5.QtWidgets import QWidget, QMessageBox, QApplication
 
 
 class Example(QWidget):
​     
​     def __init__(self):
​         super().__init__()
​         
​         self.initUI()
​         
​         
​     def initUI(self):               
​         
​         self.setGeometry(300, 300, 250, 150)        
​         self.setWindowTitle('Message box')    
​         self.show()
​         
​         
​     def closeEvent(self, event):
​         
​         reply = QMessageBox.question(self, 'Message',
​             "Are you sure to quit?", QMessageBox.Yes | 
​             QMessageBox.No, QMessageBox.No)
 
​         if reply == QMessageBox.Yes:
​             event.accept()
​         else:
​             event.ignore()        
​         
​         
 if __name__ == '__main__':
​     
​     app = QApplication(sys.argv)
​     ex = Example()
​     sys.exit(app.exec_())

如果我们关闭一个QWidget，QCloseEvent事件就会被生成。为了修改组件行为我们需要重载实现closeEvent()事件处理方法。

reply = QMessageBox.question(self, 'Message',
​     "Are you sure to quit?", QMessageBox.Yes | 
​     QMessageBox.No, QMessageBox.No)

我们创建了一个带两个按钮的消息盒子：Yes和No按钮。第一个字符串显示在标题栏上。第二个字符串是显示在对话框上的消息文本。第三个参数指定了显示在对话框上的按钮集合。最后一个参数是默认选中的按钮，这个按钮一开始就获得焦点。返回值被储存在reply变量中

if reply == QtGui.QMessageBox.Yes:
​     event.accept()
 else:
​     event.ignore()

在这里我们测试一下返回值。如果我们点击Yes按钮，我们接收到导致组件关闭和应用结束的关闭事件。否则就将忽略关闭事件。

程序预览：

![1539877029715](C:\Users\Administrator\AppData\Roaming\Typora\typora-user-images\1539877029715.png)

   

 

## 窗口居中

下面的脚本展示我们如何把窗口居中显示到桌面屏幕上。

\#!/usr/bin/python3
 \# -- coding: utf-8 --
 
 """
 ZetCode PyQt5 tutorial 
 
 This program centers a window 
 on the screen. 
 
 Author: Jan Bodnar
 Website: zetcode.com 
 Last edited: August 2017
 """
 
 import sys
 from PyQt5.QtWidgets import QWidget, QDesktopWidget, QApplication
 
 
 class Example(QWidget):
​     
​     def __init__(self):
​         super().__init__()
​         
​         self.initUI()
​         
​         
​     def initUI(self):               
​         
​         self.resize(250, 150)
​         self.center()
​         
​         self.setWindowTitle('Center')    
​         self.show()
​         
​         
​     def center(self):
​         
​         qr = self.frameGeometry()
​         cp = QDesktopWidget().availableGeometry().center()
​         qr.moveCenter(cp)
​         self.move(qr.topLeft())
​         
​         
 if __name__ == '__main__':
​     
​     app = QApplication(sys.argv)
​     ex = Example()
​     sys.exit(app.exec_())

QtGui.QDesktopWidget类提供了用户的桌面信息，包括屏幕的大小。

self.center()

将窗口居中放置的代码在自定义的center()方法中。

qr = self.frameGeometry()

我们得到一个指定了主窗口几何图形的矩形。这包含了任何的窗口框架。

cp = QDesktopWidget().availableGeometry().center()

我们计算出了我们显示器的屏幕分辨率。然后从这个分辨率，我们得到了中心点的位置。

qr.moveCenter(cp)

我们的矩形已经设置好了它的宽和高。现在我们把矩形的中心设置到屏幕的中心去。矩形的大小并不会改变。

self.move(qr.topLeft())

我们移动了应用窗口的左上方的点到qr矩形的左上方的点，因此窗口居中显示在我们的屏幕上。

程序预览：

   

​    ![1539877045761](C:\Users\Administrator\AppData\Roaming\Typora\typora-user-images\1539877045761.png)